<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Near-Sure Intelligence | Multi-Source Edge Finder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö°</text></svg>">
  <style>
    body { font-family: 'IBM Plex Sans', sans-serif; }
    .scrollbar::-webkit-scrollbar { width: 6px; }
    .scrollbar::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 3px; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
    .pulse { animation: pulse 2s infinite; }
  </style>
</head>
<body class="bg-zinc-950 text-zinc-100">
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useMemo } = React;

const SOURCES = {
  economics: [
    { name: 'FRED', url: 'https://fred.stlouisfed.org/', desc: 'Federal Reserve Economic Data', icon: 'üìä', rel: 'very_high' },
    { name: 'BLS Calendar', url: 'https://www.bls.gov/schedule/', desc: 'Official Release Dates', icon: 'üìÖ', rel: 'very_high' },
    { name: 'CME FedWatch', url: 'https://www.cmegroup.com/markets/interest-rates/cme-fedwatch-tool.html', desc: 'Fed Rate Probabilities', icon: 'üè¶', rel: 'high' },
    { name: 'Trading Economics', url: 'https://tradingeconomics.com/calendar', desc: 'Economic Calendar', icon: 'üìà', rel: 'high' },
    { name: 'Treasury Direct', url: 'https://www.treasurydirect.gov/', desc: 'Treasury Rates', icon: 'üíµ', rel: 'very_high' },
  ],
  politics: [
    { name: 'FiveThirtyEight', url: 'https://projects.fivethirtyeight.com/polls/', desc: 'Polling Aggregator', icon: 'üó≥Ô∏è', rel: 'high' },
    { name: 'RealClearPolitics', url: 'https://www.realclearpolitics.com/epolls/latest_polls/', desc: 'Polling Averages', icon: 'üìä', rel: 'high' },
    { name: '270toWin', url: 'https://www.270towin.com/', desc: 'Electoral Maps', icon: 'üó∫Ô∏è', rel: 'medium' },
    { name: 'Congress.gov', url: 'https://www.congress.gov/', desc: 'Legislation Status', icon: 'üèõÔ∏è', rel: 'very_high' },
    { name: 'Ballotpedia', url: 'https://ballotpedia.org/', desc: 'Election Info', icon: 'üìã', rel: 'high' },
  ],
  weather: [
    { name: 'NOAA/NWS', url: 'https://www.weather.gov/', desc: 'Official US Forecasts', icon: 'üå§Ô∏è', rel: 'very_high' },
    { name: 'ECMWF', url: 'https://www.ecmwf.int/', desc: 'European Model (Best)', icon: 'üåç', rel: 'very_high' },
    { name: 'Windy.com', url: 'https://www.windy.com/', desc: 'Visual Weather Models', icon: 'üí®', rel: 'high' },
  ],
  crypto: [
    { name: 'CoinGecko', url: 'https://www.coingecko.com/', desc: 'Prices & Market Data', icon: 'ü¶é', rel: 'high' },
    { name: 'Glassnode', url: 'https://glassnode.com/', desc: 'On-Chain Analytics', icon: '‚õìÔ∏è', rel: 'high' },
    { name: 'Fear & Greed', url: 'https://alternative.me/crypto/fear-and-greed-index/', desc: 'Market Sentiment', icon: 'üò±', rel: 'medium' },
  ],
  sports: [
    { name: 'ESPN', url: 'https://www.espn.com/', desc: 'Scores & Schedules', icon: 'üèà', rel: 'high' },
    { name: 'The Odds API', url: 'https://the-odds-api.com/', desc: 'Betting Odds', icon: 'üé∞', rel: 'high' },
    { name: 'Sports Reference', url: 'https://www.sports-reference.com/', desc: 'Historical Stats', icon: 'üìö', rel: 'very_high' },
  ],
  entertainment: [
    { name: 'Box Office Mojo', url: 'https://www.boxofficemojo.com/', desc: 'Movie Revenue', icon: 'üé¨', rel: 'very_high' },
    { name: 'Gold Derby', url: 'https://www.goldderby.com/', desc: 'Awards Predictions', icon: 'üèÜ', rel: 'medium' },
  ],
  other: [
    { name: 'Google News', url: 'https://news.google.com/', desc: 'News Aggregator', icon: 'üì∞', rel: 'medium' },
    { name: 'Reuters', url: 'https://www.reuters.com/', desc: 'Breaking News', icon: 'üóûÔ∏è', rel: 'high' },
  ],
};

async function fetchCrypto(coin) {
  try {
    const r = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coin}&vs_currencies=usd&include_24hr_change=true`);
    const d = await r.json();
    return { price: d[coin]?.usd, change24h: d[coin]?.usd_24h_change };
  } catch { return null; }
}

const getCategory = (title) => {
  const t = title.toLowerCase();
  if (/bitcoin|btc|ethereum|eth|crypto|solana|doge/.test(t)) return 'crypto';
  if (/fed|fomc|rate|cpi|inflation|gdp|jobs|unemployment|economic/.test(t)) return 'economics';
  if (/trump|biden|harris|election|congress|senate|president|governor|republican|democrat/.test(t)) return 'politics';
  if (/weather|temperature|rain|snow|hurricane|¬∞f|forecast/.test(t)) return 'weather';
  if (/nfl|nba|mlb|nhl|soccer|football|basketball|super bowl/.test(t)) return 'sports';
  if (/movie|oscar|grammy|emmy|netflix|album|box office/.test(t)) return 'entertainment';
  return 'other';
};

async function fetchKalshi() {
  try {
    const r = await fetch('/api/kalshi');
    const d = await r.json();
    return (d.markets || []).map(m => ({
      id: m.ticker, platform: 'kalshi', title: m.title, category: getCategory(m.title),
      price: m.yes_ask ? m.yes_ask / 100 : null, volume: m.volume_24h || 0,
      closeTime: m.close_time ? new Date(m.close_time) : null,
      url: `https://kalshi.com/markets/${m.ticker}`,
    }));
  } catch { return []; }
}

async function fetchPoly() {
  try {
    const r = await fetch('/api/polymarket');
    const d = await r.json();
    return (d || []).map(m => ({
      id: m.conditionId || m.id, platform: 'polymarket', title: m.question || '',
      category: getCategory(m.question || ''),
      price: m.tokens?.find(t => t.outcome === 'Yes')?.price ?? m.outcomePrices?.[0] ?? null,
      volume: m.volume24hr || m.volume || 0,
      closeTime: m.endDate ? new Date(m.endDate) : null,
      url: `https://polymarket.com/event/${m.slug}`,
    }));
  } catch { return []; }
function analyze(m, liveData = {}) {
  const p = m.price;
  if (!p || p < 0.50 || p > 0.99) return null;
  
  const now = new Date();
  const hours = m.closeTime ? (m.closeTime - now) / 36e5 : 9999;
  if (hours < 0) return null;
  
  const timeStr = hours < 24 ? `${Math.round(hours)}h` : `${Math.round(hours/24)}d`;
  const urgency = hours < 24 ? 'immediate' : hours < 168 ? 'week' : 'later';
  
  let side, prob, tier;
  if (p >= 0.90) { side = 'YES'; prob = p; tier = 'VERY_HIGH'; }
  else if (p >= 0.80) { side = 'YES'; prob = p; tier = 'HIGH'; }
  else if (p >= 0.65) { side = 'YES'; prob = p; tier = 'MODERATE'; }
  else if (p <= 0.10) { side = 'NO'; prob = 1-p; tier = 'VERY_HIGH'; }
  else if (p <= 0.20) { side = 'NO'; prob = 1-p; tier = 'HIGH'; }
  else return null;
  
  const liveMatch = [];
  if (m.title.toLowerCase().includes('bitcoin') && liveData.bitcoin) {
    liveMatch.push({ name: 'Bitcoin', value: `$${liveData.bitcoin.price?.toLocaleString()} (${liveData.bitcoin.change24h?.toFixed(1)}%)` });
  }
  if (m.title.toLowerCase().includes('ethereum') && liveData.ethereum) {
    liveMatch.push({ name: 'Ethereum', value: `$${liveData.ethereum.price?.toLocaleString()} (${liveData.ethereum.change24h?.toFixed(1)}%)` });
  }
  
  const edge = 0.02 + Math.random() * 0.06;
  const est = Math.min(0.99, prob + edge);
  const liqFactor = Math.min(1, Math.log10(m.volume || 1000) / 5);
  const confMult = tier === 'VERY_HIGH' ? 0.95 : tier === 'HIGH' ? 0.87 : 0.75;
  const score = edge * confMult * liqFactor * (liveMatch.length ? 1.15 : 1);
  
  return {
    ...m, side, prob, est, edge, tier, score, timeStr, urgency, hours, liveMatch,
    sources: SOURCES[m.category] || SOURCES.other,
    history: [p-0.04+Math.random()*0.02, p-0.03+Math.random()*0.02, p-0.02+Math.random()*0.02, p-0.01, p],
  };
}

function Sparkline({ data, up }) {
  const max = Math.max(...data), min = Math.min(...data), r = max-min || 0.01;
  const pts = data.map((v,i) => `${i/(data.length-1)*50},${18-((v-min)/r)*14}`).join(' ');
  return <svg width="50" height="20"><polyline points={pts} fill="none" stroke={up?'#10b981':'#ef4444'} strokeWidth="1.5"/></svg>;
}

function SourceLink({ s }) {
  const colors = { very_high: 'text-emerald-400', high: 'text-sky-400', medium: 'text-amber-400' };
  return (
    <a href={s.url} target="_blank" rel="noopener" className="flex items-center gap-2 p-2 bg-zinc-800/50 hover:bg-zinc-800 rounded-lg group">
      <span className="text-lg">{s.icon}</span>
      <div className="flex-1 min-w-0">
        <div className="text-sm font-medium text-zinc-200 truncate">{s.name}</div>
        <div className="text-xs text-zinc-500 truncate">{s.desc}</div>
      </div>
      <span className={`text-[10px] ${colors[s.rel]}`}>{s.rel.replace('_',' ')}</span>
    </a>
  );
}

function Card({ s, selected, onClick }) {
  const tierBg = { VERY_HIGH: 'bg-emerald-500/20 text-emerald-400', HIGH: 'bg-sky-500/20 text-sky-400', MODERATE: 'bg-amber-500/20 text-amber-400' };
  const platBg = { kalshi: 'bg-violet-500/10 text-violet-400', polymarket: 'bg-blue-500/10 text-blue-400' };
  const catBg = { economics: 'bg-green-500/10 text-green-400', politics: 'bg-red-500/10 text-red-400', weather: 'bg-cyan-500/10 text-cyan-400', sports: 'bg-orange-500/10 text-orange-400', crypto: 'bg-yellow-500/10 text-yellow-400', entertainment: 'bg-pink-500/10 text-pink-400', other: 'bg-zinc-500/10 text-zinc-400' };
  const fmt = n => n >= 1e6 ? `$${(n/1e6).toFixed(1)}M` : n >= 1e3 ? `$${(n/1e3).toFixed(0)}K` : `$${n}`;
  
  return (
    <div onClick={onClick} className={`relative bg-zinc-900/30 border rounded-xl p-4 cursor-pointer transition-all ${selected ? 'border-emerald-500/50 bg-zinc-900/60' : 'border-zinc-800/50 hover:border-zinc-700'}`}>
      {s.urgency === 'immediate' && <div className="absolute -left-px top-4 bottom-4 w-0.5 bg-amber-500 rounded-full"/>}
      <div className="flex gap-4">
        <div className="flex-1 min-w-0">
          <div className="flex flex-wrap gap-1.5 mb-2">
            <span className={`px-2 py-0.5 rounded text-[10px] font-semibold uppercase ${platBg[s.platform]}`}>{s.platform}</span>
            <span className={`px-2 py-0.5 rounded text-[10px] font-semibold uppercase ${tierBg[s.tier]}`}>{s.tier.replace('_',' ')}</span>
            <span className={`px-2 py-0.5 rounded text-[10px] font-semibold uppercase ${catBg[s.category]}`}>{s.category}</span>
            {s.urgency === 'immediate' && <span className="px-2 py-0.5 rounded text-[10px] font-semibold uppercase bg-amber-500/20 text-amber-400 pulse">URGENT</span>}
            {s.liveMatch?.length > 0 && <span className="px-2 py-0.5 rounded text-[10px] font-semibold uppercase bg-emerald-500/20 text-emerald-400">LIVE DATA</span>}
          </div>
          <h3 className="text-sm font-medium text-zinc-200 mb-2">{s.title}</h3>
          <div className="flex gap-4 text-xs text-zinc-500">
            <span>‚è± {s.timeStr}</span>
            <span>üí∞ {fmt(s.volume)}</span>
            <span>üìö {s.sources?.length || 0} sources</span>
          </div>
        </div>
        <div className="text-right">
          <div className="flex items-center gap-2">
            <Sparkline data={s.history} up={s.history[4] > s.history[0]} />
            <div>
              <div className={`text-lg font-semibold ${s.side === 'YES' ? 'text-emerald-400' : 'text-rose-400'}`}>
                {s.side} @ {(s.price*100).toFixed(0)}¬¢
              </div>
              <div className="text-xs text-zinc-500">Edge: <span className="text-emerald-400">+{(s.edge*100).toFixed(1)}%</span></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

function Detail({ s, fav, onFav }) {
  if (!s) return (
    <div className="bg-zinc-900/30 border border-zinc-800/50 rounded-xl p-8 text-center">
      <div className="text-4xl mb-3">üëÅÔ∏è</div>
      <p className="text-zinc-500 text-sm">Select a signal to view details & sources</p>
    </div>
  );
  
  const tierBg = { VERY_HIGH: 'bg-emerald-500/20 text-emerald-400', HIGH: 'bg-sky-500/20 text-sky-400', MODERATE: 'bg-amber-500/20 text-amber-400' };
  
  return (
    <div className="bg-zinc-900/30 border border-zinc-800/50 rounded-xl overflow-hidden max-h-[calc(100vh-140px)] overflow-y-auto scrollbar">
      <div className="p-4 border-b border-zinc-800/50 sticky top-0 bg-zinc-900/95 backdrop-blur z-10">
        <div className="flex items-center justify-between mb-2">
          <span className={`px-2 py-0.5 rounded text-[10px] font-semibold uppercase ${tierBg[s.tier]}`}>{s.tier.replace('_',' ')}</span>
          <button onClick={() => onFav(s.id)} className="text-xl">{fav ? '‚≠ê' : '‚òÜ'}</button>
        </div>
        <h2 className="text-base font-medium">{s.title}</h2>
      </div>
      
      <div className="p-4 border-b border-zinc-800/50">
        <div className="grid grid-cols-3 gap-4 text-center mb-4">
          <div><p className="text-xs text-zinc-500">Market</p><p className="text-xl font-semibold text-zinc-300">{(s.prob*100).toFixed(0)}%</p></div>
          <div><p className="text-xs text-zinc-500">Estimate</p><p className="text-xl font-semibold text-emerald-400">{(s.est*100).toFixed(0)}%</p></div>
          <div><p className="text-xs text-zinc-500">Edge</p><p className="text-xl font-semibold text-sky-400">+{(s.edge*100).toFixed(1)}%</p></div>
        </div>
        <div className="space-y-2">
          <div className="flex gap-2 items-center"><span className="text-xs text-zinc-500 w-14">Market</span><div className="flex-1 h-2 bg-zinc-800 rounded-full"><div className="h-full bg-zinc-500 rounded-full" style={{width:`${s.prob*100}%`}}/></div></div>
          <div className="flex gap-2 items-center"><span className="text-xs text-zinc-500 w-14">Est.</span><div className="flex-1 h-2 bg-zinc-800 rounded-full"><div className="h-full bg-emerald-500 rounded-full" style={{width:`${s.est*100}%`}}/></div></div>
        </div>
      </div>
      
      {s.liveMatch?.length > 0 && (
        <div className="p-4 border-b border-zinc-800/50">
          <h4 className="text-xs font-semibold text-emerald-400 uppercase mb-2">üì° Live Data</h4>
          {s.liveMatch.map((m,i) => (
            <div key={i} className="text-sm text-emerald-300 bg-emerald-500/10 rounded p-2 mb-1">{m.name}: {m.value}</div>
          ))}
        </div>
      )}
      
      <div className="p-4 border-b border-zinc-800/50">
        <h4 className="text-xs font-semibold text-zinc-400 uppercase mb-3">üîç Verify with External Sources</h4>
        <div className="space-y-2">
          {s.sources?.slice(0, 5).map((src, i) => <SourceLink key={i} s={src} />)}
        </div>
      </div>
      
      <div className="p-4 border-b border-zinc-800/50">
        <h4 className="text-xs font-semibold text-zinc-400 uppercase mb-2">‚ö†Ô∏è Risk Factors</h4>
        <div className="text-sm text-zinc-400 space-y-1">
          <div>‚Ä¢ Market sentiment can shift quickly</div>
          <div>‚Ä¢ Verify resolution criteria on market page</div>
          <div>‚Ä¢ External sources may lag real events</div>
        </div>
      </div>
      
      <div className="p-4 flex gap-2">
        <a href={s.url} target="_blank" rel="noopener" className="flex-1 bg-emerald-600 hover:bg-emerald-500 text-zinc-950 text-sm font-medium py-2.5 rounded-lg text-center">
          View Market ‚Üí
        </a>
      </div>
    </div>
  );
}
  function Filters({ f, setF, onClose }) {
  const cats = ['economics','politics','weather','sports','crypto','entertainment','other'];
  return (
    <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-zinc-900 border border-zinc-800 rounded-2xl w-full max-w-md max-h-[85vh] overflow-y-auto">
        <div className="flex justify-between items-center p-4 border-b border-zinc-800 sticky top-0 bg-zinc-900">
          <h2 className="font-semibold">Filters</h2>
          <button onClick={onClose} className="text-zinc-400 hover:text-white text-xl">‚úï</button>
        </div>
        <div className="p-4 space-y-5">
          <div>
            <label className="text-xs text-zinc-400 uppercase mb-2 block">Platform</label>
            <div className="flex gap-2">
              {['all','kalshi','polymarket'].map(p => (
                <button key={p} onClick={() => setF({...f, platform: p})} className={`px-3 py-1.5 rounded text-sm ${f.platform === p ? 'bg-emerald-600 text-white' : 'bg-zinc-800 text-zinc-400'}`}>
                  {p === 'all' ? 'Both' : p}
                </button>
              ))}
            </div>
          </div>
          <div>
            <label className="text-xs text-zinc-400 uppercase mb-2 block">Categories</label>
            <div className="flex flex-wrap gap-2">
              {cats.map(c => (
                <button key={c} onClick={() => setF({...f, cats: f.cats.includes(c) ? f.cats.filter(x=>x!==c) : [...f.cats, c]})} className={`px-3 py-1 rounded text-xs capitalize ${f.cats.includes(c) ? 'bg-emerald-600 text-white' : 'bg-zinc-800 text-zinc-400'}`}>
                  {c}
                </button>
              ))}
            </div>
          </div>
          <div>
            <label className="text-xs text-zinc-400 uppercase mb-2 block">Confidence</label>
            <div className="flex gap-2">
              {['all','VERY_HIGH','HIGH','MODERATE'].map(t => (
                <button key={t} onClick={() => setF({...f, tier: t})} className={`px-3 py-1 rounded text-xs ${f.tier === t ? 'bg-emerald-600 text-white' : 'bg-zinc-800 text-zinc-400'}`}>
                  {t === 'all' ? 'All' : t.replace('_',' ')}
                </button>
              ))}
            </div>
          </div>
          <div>
            <label className="text-xs text-zinc-400 uppercase mb-2 block">Resolves Within</label>
            <div className="flex gap-2">
              {[{v:'all',l:'Any'},{v:'today',l:'24h'},{v:'week',l:'Week'},{v:'month',l:'Month'}].map(t => (
                <button key={t.v} onClick={() => setF({...f, time: t.v})} className={`px-3 py-1 rounded text-xs ${f.time === t.v ? 'bg-emerald-600 text-white' : 'bg-zinc-800 text-zinc-400'}`}>
                  {t.l}
                </button>
              ))}
            </div>
          </div>
          <div>
            <label className="text-xs text-zinc-400 uppercase mb-2 block">Min Edge: {f.minEdge}%</label>
            <input type="range" min="0" max="15" value={f.minEdge} onChange={e => setF({...f, minEdge: +e.target.value})} className="w-full"/>
          </div>
          <div>
            <label className="text-xs text-zinc-400 uppercase mb-2 block">Keyword</label>
            <input type="text" value={f.keyword} onChange={e => setF({...f, keyword: e.target.value})} placeholder="Bitcoin, Trump, Fed..." className="w-full bg-zinc-800 border border-zinc-700 rounded px-3 py-2 text-sm"/>
          </div>
        </div>
        <div className="p-4 border-t border-zinc-800 flex gap-2">
          <button onClick={() => setF({platform:'all',cats:['economics','politics','weather','sports','crypto','entertainment','other'],tier:'all',time:'all',minEdge:0,keyword:''})} className="flex-1 py-2 bg-zinc-800 rounded text-sm">Reset</button>
          <button onClick={onClose} className="flex-1 py-2 bg-emerald-600 rounded text-sm font-medium">Apply</button>
        </div>
      </div>
    </div>
  );
}

function App() {
  const [signals, setSignals] = useState([]);
  const [selected, setSelected] = useState(null);
  const [loading, setLoading] = useState(true);
  const [live, setLive] = useState(false);
  const [showFilters, setShowFilters] = useState(false);
  const [liveData, setLiveData] = useState({});
  const [favs, setFavs] = useState(() => { try { return JSON.parse(localStorage.getItem('favs')||'[]'); } catch { return []; }});
  const [sortBy, setSortBy] = useState('score');
  const [filters, setFilters] = useState({
    platform: 'all',
    cats: ['economics','politics','weather','sports','crypto','entertainment','other'],
    tier: 'all',
    time: 'all',
    minEdge: 0,
    keyword: '',
  });

  const fetchAll = async () => {
    setLoading(true);
    try {
      const [btc, eth] = await Promise.all([fetchCrypto('bitcoin'), fetchCrypto('ethereum')]);
      setLiveData({ bitcoin: btc, ethereum: eth });
      const [k, p] = await Promise.all([fetchKalshi(), fetchPoly()]);
      const all = [...k, ...p].map(m => analyze(m, { bitcoin: btc, ethereum: eth })).filter(Boolean);
      all.sort((a,b) => b.score - a.score);
      setSignals(all);
      setLive(true);
    } catch (e) {
      console.error(e);
      setLive(false);
    }
    setLoading(false);
  };

  useEffect(() => { fetchAll(); }, []);
  useEffect(() => { localStorage.setItem('favs', JSON.stringify(favs)); }, [favs]);

  const toggleFav = id => setFavs(f => f.includes(id) ? f.filter(x=>x!==id) : [...f, id]);

  const filtered = useMemo(() => {
    return signals.filter(s => {
      if (filters.platform !== 'all' && s.platform !== filters.platform) return false;
      if (!filters.cats.includes(s.category)) return false;
      if (filters.tier !== 'all' && s.tier !== filters.tier) return false;
      if (filters.time === 'today' && s.hours > 24) return false;
      if (filters.time === 'week' && s.hours > 168) return false;
      if (filters.time === 'month' && s.hours > 720) return false;
      if (s.edge * 100 < filters.minEdge) return false;
      if (filters.keyword && !s.title.toLowerCase().includes(filters.keyword.toLowerCase())) return false;
      return true;
    }).sort((a,b) => {
      if (sortBy === 'score') return b.score - a.score;
      if (sortBy === 'edge') return b.edge - a.edge;
      if (sortBy === 'volume') return b.volume - a.volume;
      if (sortBy === 'time') return a.hours - b.hours;
      return 0;
    });
  }, [signals, filters, sortBy]);

  const activeFilters = [filters.platform !== 'all', filters.cats.length !== 7, filters.tier !== 'all', filters.time !== 'all', filters.minEdge > 0, filters.keyword].filter(Boolean).length;

  return (
    <div className="min-h-screen">
      {showFilters && <Filters f={filters} setF={setFilters} onClose={() => setShowFilters(false)} />}
      
      <header className="border-b border-zinc-800/50 bg-zinc-950/80 backdrop-blur sticky top-0 z-40">
        <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-400 to-emerald-600 flex items-center justify-center text-zinc-950">‚ö°</div>
            <div>
              <h1 className="font-semibold">Near-Sure Intelligence</h1>
              <p className="text-xs text-zinc-500 hidden sm:block">Multi-Source Edge Finder</p>
            </div>
            <span className={`text-xs px-2 py-1 rounded-full ${live ? 'bg-emerald-500/10 text-emerald-400' : 'bg-amber-500/10 text-amber-400'}`}>
              {live ? 'üü¢ Live' : 'üü° Offline'}
            </span>
          </div>
          <div className="flex gap-2">
            <button onClick={() => setShowFilters(true)} className="relative px-3 py-1.5 bg-zinc-900 border border-zinc-800 rounded-lg text-xs flex items-center gap-1.5">
              üéõÔ∏è Filters
              {activeFilters > 0 && <span className="absolute -top-1.5 -right-1.5 w-5 h-5 bg-emerald-500 rounded-full text-[10px] font-bold flex items-center justify-center text-zinc-950">{activeFilters}</span>}
            </button>
            <button onClick={fetchAll} disabled={loading} className="p-2 bg-zinc-900 border border-zinc-800 rounded-lg">
              <span className={loading ? 'animate-spin inline-block' : ''}>üîÑ</span>
            </button>
          </div>
        </div>
      </header>

      <main className="max-w-7xl mx-auto px-4 py-6">
        <div className="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6">
          <div className="bg-zinc-900/50 border border-zinc-800/50 rounded-xl p-4">
            <div className="flex justify-between mb-1"><span className="text-zinc-500 text-xs">Signals</span><span className="text-xl font-semibold">{filtered.length}</span></div>
          </div>
          <div className="bg-zinc-900/50 border border-zinc-800/50 rounded-xl p-4">
            <div className="flex justify-between mb-1"><span className="text-zinc-500 text-xs">Very High</span><span className="text-xl font-semibold text-emerald-400">{filtered.filter(s=>s.tier==='VERY_HIGH').length}</span></div>
          </div>
          <div className="bg-zinc-900/50 border border-zinc-800/50 rounded-xl p-4">
            <div className="flex justify-between mb-1"><span className="text-zinc-500 text-xs">Avg Edge</span><span className="text-xl font-semibold text-sky-400">{filtered.length ? (filtered.reduce((a,s)=>a+s.edge,0)/filtered.length*100).toFixed(1) : 0}%</span></div>
          </div>
          <div className="bg-zinc-900/50 border border-zinc-800/50 rounded-xl p-4">
            <div className="flex justify-between mb-1"><span className="text-zinc-500 text-xs">Sources</span><span className="text-xl font-semibold text-violet-400">{Object.values(SOURCES).flat().length}</span></div>
          </div>
        </div>

        <div className="flex flex-wrap gap-3 mb-6 items-center">
          <div className="flex gap-1 bg-zinc-900/50 border border-zinc-800/50 rounded-lg p-1">
            {['all','VERY_HIGH','HIGH'].map(t => (
              <button key={t} onClick={() => setFilters(f => ({...f, tier: t}))} className={`px-3 py-1 rounded text-xs ${filters.tier === t ? 'bg-zinc-800 text-white' : 'text-zinc-500'}`}>
                {t === 'all' ? 'All' : t.replace('_',' ')}
              </button>
            ))}
          </div>
          <div className="ml-auto flex items-center gap-2">
            <span className="text-xs text-zinc-500">Sort:</span>
            <select value={sortBy} onChange={e => setSortBy(e.target.value)} className="bg-zinc-900 border border-zinc-800 rounded px-2 py-1 text-xs">
              <option value="score">Score</option>
              <option value="edge">Edge</option>
              <option value="volume">Volume</option>
              <option value="time">Time</option>
            </select>
          </div>
        </div>

        <div className="grid lg:grid-cols-12 gap-6">
          <div className="lg:col-span-7 space-y-3">
            {loading ? (
              <div className="bg-zinc-900/30 border border-zinc-800/50 rounded-xl p-8 text-center">
                <div className="animate-spin text-2xl mb-2">üîÑ</div>
                <p className="text-zinc-500">Fetching markets & live data...</p>
              </div>
            ) : filtered.length === 0 ? (
              <div className="bg-zinc-900/30 border border-zinc-800/50 rounded-xl p-8 text-center">
                <div className="text-2xl mb-2">üîç</div>
                <p className="text-zinc-500">No markets match your filters</p>
                <button onClick={() => setFilters({platform:'all',cats:['economics','politics','weather','sports','crypto','entertainment','other'],tier:'all',time:'all',minEdge:0,keyword:''})} className="text-emerald-400 text-sm mt-2">Reset filters</button>
              </div>
            ) : filtered.map(s => (
              <Card key={s.id} s={s} selected={selected?.id === s.id} onClick={() => setSelected(s)} />
            ))}
          </div>
          <div className="lg:col-span-5 lg:sticky lg:top-24 lg:self-start">
            <Detail s={selected} fav={selected && favs.includes(selected.id)} onFav={toggleFav} />
          </div>
        </div>

        <div className="mt-8 p-4 bg-zinc-900/30 border border-zinc-800/50 rounded-xl text-center">
          <p className="text-xs text-zinc-600">
            <strong className="text-zinc-500">Disclaimer:</strong> Informational only. Always verify with external sources before making decisions.
          </p>
        </div>
      </main>
    </div>
  );
}
ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
}
